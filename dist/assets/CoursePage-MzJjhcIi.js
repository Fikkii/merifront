import{f as m,_ as E}from"./Modal-DVGjIwmO.js";import{f as S}from"./style-BPndgJTN.js";import{d as n,c as b,o as v,a as d,i as C,b as _,u as N,f as $,e as j,m as z,h as F,j as P,w,k as V,n as A,l as f}from"./index-luTevwiG.js";const U={class:"max-w-lg w-full mx-auto px-4 py-6"},D={key:0,class:"relative w-full"},L={__name:"ImageCropper",setup(x,{expose:g}){const o=n(null),l=n(null),u=a=>{const s=a.target.files[0];if(s&&s.type.startsWith("image/")){const i=new FileReader;i.onload=c=>{o.value=c.target.result},i.readAsDataURL(s)}};return g({getCroppedImage:async()=>{var s;const a=(s=l.value)==null?void 0:s.getResult();if(a!=null&&a.canvas)return await new Promise(c=>a.canvas.toBlob(c,"image/jpeg",.9))}}),(a,s)=>(v(),b("div",U,[d("input",{type:"file",accept:"image/*",onChange:u,class:"mb-4 block w-full border rounded p-2 text-sm"},null,32),o.value?(v(),b("div",D,[_(N(S),{ref_key:"cropper",ref:l,src:o.value,class:"w-full h-[400px] sm:h-[500px] rounded shadow-md overflow-hidden","stencil-props":{aspectRatio:16/9,movable:!0,scalable:!1,resizable:!0},"auto-zoom":!0,"resize-image":{adjustStencil:!0},transitions:!0,"background-class":"bg-white"},null,8,["src"])])):C("",!0)]))}},G={__name:"CoursePage",props:{dashboard:{type:Boolean,default:!1}},setup(x){const g=$();j();const o=n(null),l=n(!1),u=n(null),r=n(null),a=n(null),s=n([{name:"title",placeholder:"Enter Course Title",type:"text",res:""},{name:"price",placeholder:"Enter Course Pricing",type:"number",res:""},{name:"description",placeholder:"Enter Course Description",type:"text",res:""}]);z(async()=>{o.value=await m()});async function i(e){await f.delete(`/api/admin/courses/${e}`),o.value=await m()}async function c(e="1"){r.value=e;const t=await f.get(`/api/courses/${e}`),R=Object.entries(t.data).map(([p,B])=>["id","cover_img_url"].includes(p)?null:{name:p,placeholder:"No placeholder",type:"text",res:B}).filter(p=>p!=null);a.value=R,l.value=!0,o.value=await m()}async function y(e){if(r.value){const t=await u.value.getCroppedImage();if(!t){g.error("Please Image needs to be re-uploaded");return}e.append("image",t,"cropped-img"),await f.put(`/api/admin/courses/${r.value}`,e,{headers:{"Content-Type":"multipart/form-data"}})}else{const t=await u.value.getCroppedImage();e.append("image",t,"cropped-img"),await f.post("/api/admin/courses",e,{headers:{"Content-Type":"multipart/form-data"}})}o.value=await m(),l.value=!l.value}function k(e,t){r.value?a.value[e].res=t:s.value[e].res=t}function I(){l.value=!1}function T(){l.value=!0,a.value=null,r.value=null}return(e,t)=>{const h=F("Table");return v(),b("div",null,[d("div",null,[l.value?(v(),P(E,{key:0,fields:a.value||s.value,onUpdate:k,onClose:I,edit:r.value,onSubmit:y},{default:w(()=>[_(L,{ref_key:"imageRef",ref:u},null,512)]),_:1},8,["fields","edit"])):C("",!0)]),d("div",{class:A([l.value?"blur":""])},[_(h,{onDelete:i,onEdit:c,items:o.value},{default:w(()=>[d("button",{onClick:T,class:"bg-blue-500 ms-auto py-2 text-white block col-start-2 w-[100px] rounded"},t[0]||(t[0]=[d("i",{class:"ri-add-line"},null,-1),V("Add Course")]))]),_:1},8,["items"])],2)])}}};export{G as default};
